groups:
  - name: fb_ads_bot_alerts
    rules:
      # Application Health Alerts
      - alert: BotApplicationDown
        expr: up{job="fb-ads-bot"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Facebook Ads Bot application is down"
          description: "The Facebook Ads Bot application has been down for more than 1 minute"

      - alert: BotHealthCheckFailed
        expr: up{job="fb-ads-bot"} == 0 or (rate(http_request_duration_seconds_count{job="fb-ads-bot"}[5m]) == 0)
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Bot health check failed"
          description: "Bot health check endpoint is not responding"

      # Performance Alerts
      - alert: HighCPUUsage
        expr: cpu_usage_percent > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is {{ $value }}% for more than 5 minutes"

      - alert: HighMemoryUsage
        expr: memory_usage_percent > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is {{ $value }}% for more than 5 minutes"

      - alert: LowDiskSpace
        expr: disk_usage_percent > 90
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Low disk space"
          description: "Disk usage is {{ $value }}% - critically low space"

      # Database Alerts
      - alert: DatabaseDown
        expr: up{job="postgres"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "PostgreSQL database is down"
          description: "PostgreSQL database has been unreachable for more than 30 seconds"

      # API Alerts
      - alert: OpenAIAPIUnreachable
        expr: openai_api_status != 1
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "OpenAI API unreachable"
          description: "OpenAI API has been unreachable for more than 3 minutes"

      - alert: FacebookAPIUnreachable
        expr: facebook_api_status != 1
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "Facebook API unreachable"
          description: "Facebook API has been unreachable for more than 3 minutes"

      # Application Specific Alerts
      - alert: NotificationServiceDown
        expr: notification_service_status != 1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Notification service is down"
          description: "Bot notification service has been down for more than 2 minutes"

      - alert: HighErrorRate
        expr: rate(bot_errors_total[5m]) > 0.1
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }} errors per second over 5 minutes"

      - alert: TooManyFailedRequests
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High rate of 5xx errors"
          description: "High rate of 5xx HTTP errors: {{ $value }} per second"

  - name: infrastructure_alerts
    rules:
      # Nginx Alerts
      - alert: NginxDown
        expr: up{job="nginx"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Nginx is down"
          description: "Nginx reverse proxy has been down for more than 30 seconds"

      # Redis Alerts (if using)
      - alert: RedisDown
        expr: up{job="redis"} == 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Redis is down"
          description: "Redis cache server has been down for more than 1 minute"

      # Container Alerts
      - alert: ContainerRestarting
        expr: increase(container_restarts_total[1h]) > 0
        labels:
          severity: warning
        annotations:
          summary: "Container restarting"
          description: "Container {{ $labels.container }} has restarted {{ $value }} times in the last hour" 