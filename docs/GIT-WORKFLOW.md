# Правильная работа с Git

## Основные правила

1. **НИКОГДА** не работайте напрямую в ветке restructure-before-split или main
2. Всегда создавайте отдельную ветку для работы
3. Делайте частые бэкапы
4. Используйте наш скрипт вместо прямых команд Git

## Как правильно работать

### 1. Начало работы

```bash
./tools/git-workflow.sh feature моя-задача
```

### 2. Сохранение изменений

```bash
./tools/git-workflow.sh commit
```

### 3. Завершение работы

```bash
./tools/git-workflow.sh finish
```

### 4. Восстановление в случае проблем

```bash
./tools/git-workflow.sh restore
```

## Что делать при конфликтах

Если система обнаружит конфликты при попытке слияния, она предложит варианты:

1. Создать новую ветку из целевой ветки и перенести изменения
2. Продолжить слияние вручную
3. Отменить операцию

**Всегда выбирайте самый безопасный вариант!**

## Установка и настройка

1. Сначала настройте Git-хуки:
```bash
chmod +x tools/setup-git-hooks.sh
./tools/setup-git-hooks.sh
```

2. Сделайте рабочий скрипт исполняемым:
```bash
chmod +x tools/git-workflow.sh
```

## Правильный порядок работы

### 1. Всегда начинайте работу с создания новой ветки

```bash
# Для новой функциональности:
./tools/git-workflow.sh feature название-функции

# Для исправления бага:
./tools/git-workflow.sh bugfix название-бага

# Для срочных исправлений:
./tools/git-workflow.sh hotfix название-исправления
```

Скрипт предложит выбрать базовую ветку для создания новой ветки. По умолчанию это будет ветка `restructure-before-split`.

### 2. Вносите изменения и сохраняйте их:

```bash
# Вносите изменения в код

# После завершения этапа работы:
./tools/git-workflow.sh commit

# Введите осмысленное сообщение коммита
```

### 3. По завершении работы сливайте изменения в нужную ветку:

```bash
./tools/git-workflow.sh finish
```

Скрипт:
1. Создаст финальный бэкап ветки
2. Архивирует весь проект
3. Предложит выбрать целевую ветку для слияния (по умолчанию `restructure-before-split`)
4. Спросит подтверждение
5. Сольет изменения в выбранную ветку
6. Обновит тег working-version
7. Предложит удалить ветку

### 4. Восстановление при ошибках:

Если что-то пошло не так, всегда можно восстановиться из тега:

```bash
# Показать все доступные теги:
./tools/git-workflow.sh tags

# Восстановить из конкретного тега:
./tools/git-workflow.sh restore имя-тега

# Или просто восстановиться из рабочей версии:
git checkout working-version
```

## Автоматические бэкапы

Система создает несколько типов автоматических бэкапов:

1. `stable_*` - автоматические бэкапы при коммитах
2. `auto_backup_*` - бэкапы при использовании pre-commit хука
3. `save_*` - сохранения в процессе работы
4. `final_*` - финальные версии перед слиянием
5. `working-version` - всегда указывает на последнюю рабочую версию

## Правила безопасности:

1. **НИКОГДА** не коммитьте напрямую в ветки restructure-before-split или main
2. Перед каждым слиянием проверяйте изменения
3. Всегда создавайте полные бэкапы перед важными изменениями
4. Указывайте осмысленные сообщения коммитов
5. Регулярно создавайте точки восстановления

## Аварийное восстановление

При потере данных или проблемах с репозиторием:

1. Восстановитесь из тега:
```bash
git checkout working-version
# или
git checkout stable_ДАТА_ВРЕМЯ
```

2. Или распакуйте полный бэкап из директории backups/

3. В экстренном случае используйте:
```bash
git reflog
# Найдите нужный коммит и восстановитесь
git checkout ХЕШ-КОММИТА
``` 